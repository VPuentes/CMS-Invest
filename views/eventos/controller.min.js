angular.module("inspinia").controller("Eventos",["$rootScope","$scope","$state","$http","$stateParams","SweetAlert","DTOptionsBuilder","DTColumnDefBuilder",function(e,o,t,n,r,a,s,i){o.dtOptions=s.newOptions().withOption("bFilter",!1).withOption("order",[0,"desc"]).withLanguage({sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}}),o.DTColumnDefs=[i.newColumnDef(5).notSortable()],o.loading=!0,n.get("php/eventos.php").success(function(e){o.eventos=e,o.loading=!1}),o.obtener=function(e){o.evento_principal=e},o.publicar=function(e,r,s){if(1==r)var i="¿Esta seguro que desea publicar el evento?";else{if("1"==s)return void a.swal("No se puede remover el evento principal","Debe seleccionar otro evento como principal para poder removerlo");var i="¿Esta seguro que desea remover la publicacion del evento?"}a.swal({title:i,text:"",type:"warning",showCancelButton:!0,confirmButtonColor:"#559bdd",confirmButtonText:"Si",cancelButtonText:"NO",closeOnConfirm:!0,closeOnCancel:!0},function(a){a&&n({method:"POST",url:"php/eventos_publicar.php?idevento="+e+"&numero="+r,data:JSON.stringify(o.valores)}).success(function(e,o,n,r){t.go(t.current,{},{reload:!0})}).error(function(e,o,t,n){console.log("error")})})},o.principal=function(){return void 0==o.evento_principal?void a.swal({title:"Debe seleccionar un evento",confirmButtonColor:"#559bdd"}):void a.swal({title:"¿Esta seguro que desea este evento como el principal?",text:"",type:"warning",showCancelButton:!0,confirmButtonColor:"#559bdd",confirmButtonText:"Si",cancelButtonText:"NO",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&n({method:"POST",url:"php/eventos_principal.php?idevento="+o.evento_principal,data:JSON.stringify(o.valores)}).success(function(e,o,n,r){t.go(t.current,{},{reload:!0})}).error(function(e,o,t,n){console.log("error ")})})}}]).controller("EventoNuevo",["$rootScope","$scope","$http","$stateParams","SweetAlert","$state","Upload",function(e,o,t,n,r,a,s){o.center={lat:27.469592089206223,lng:-99.50154304504395,zoom:15},o.controls={fullscreen:{position:"topleft"}},o.color="#099f31",o.makiMarkerIcon={type:"makiMarker",icon:"embassy",color:o.color,size:"l",accessToken:"pk.eyJ1IjoiZGFzdGVyeSIsImEiOiJjajB2ZGoyc3UwMDE4MzJtcGtyemw1bXo3In0.aAiUO1_cexQiW--jFws_9A"},o.options={floor:0,ceil:100,showTicks:10,showTicksValues:!0,keyboardSupport:!0,translate:function(e,o,t){switch(t){case"model":return e+"%";case"high":return e+"%";default:return e+"%"}}},o.events={},o.markers=new Array,o.$on("leafletDirectiveMap.click",function(e,t){var n=t.leafletEvent;o.markers=new Array,o.markers.push({lat:n.latlng.lat,lng:n.latlng.lng,icon:o.makiMarkerIcon,message:n.latlng.lat+", "+n.latlng.lng}),o.forma.latitud=n.latlng.lat,o.forma.longitud=n.latlng.lng}),o.layers={baselayers:{googleRoadmap:{name:"Vista 1",layerType:"ROADMAP",type:"google"},googleHybrid:{name:"Vista 2",layerType:"HYBRID",type:"google"}}};var i=new Date;n.idevento?(o.loading=!0,t.get("php/evento.php?idevento="+n.idevento).success(function(t){o.forma=t,o.forma.idusuario=e.datos.idusuario,o.center={lat:o.forma.latitud,lng:o.forma.longitud,zoom:15},o.markers=new Array,o.markers.push({lat:o.forma.latitud,lng:o.forma.longitud,icon:o.makiMarkerIcon,message:o.forma.latitud+", "+o.forma.longitud}),o.loading=!1})):o.forma={idevento:0,idusuario:e.datos.idusuario,nombre:"",tipo_evento:"Publico",lugar:"",detalles:"",latitud:0,longitud:0,fecha_evento:i,activo:!0,imagenes:[],rutas:[]},o.ver=function(){console.log(o.forma)},o.agregar=function(){o.forma.fecha_evento=moment(o.forma.fecha_evento).toDate(),s.upload({url:"php/eventos_agregar.php",data:o.forma,method:"POST"}).then(function(e){e.data.status&&a.go("eventos.index")},function(e){console.log("Error status: "+e.status)})},o.eliminarImg=function(e){t.get("php/eventos_imagenes_eliminar.php?idevento_imagen="+e).success(function(e){e.status&&a.go(a.current,{},{reload:!0})})}}]);